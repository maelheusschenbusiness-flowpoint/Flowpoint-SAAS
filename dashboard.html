<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FlowPoint AI ‚Äî Dashboard</title>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --muted:#667085;
      --text:#0b1220;
      --border:#e6eaf2;
      --blue:#0052CC;
      --blue2:#E8F0FF;
      --danger:#B00020;
      --ok:#0A7A2F;
      --shadow:0 10px 30px rgba(16,24,40,.06);
      --radius:16px;
    }
    body{font-family:system-ui,Arial;background:#f4f6fb;margin:0;color:var(--text)}
    .wrap{max-width:1180px;margin:24px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);margin-bottom:14px}
    .top{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-start}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted);font-size:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:280px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:#f3f4f6;color:var(--text);font-weight:800;font-size:12px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--blue2);color:var(--blue);font-weight:900;font-size:12px}
    .btn{background:var(--blue);color:#fff;border:0;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
    .btn2{background:#111827;color:#fff;border:0;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
    .btn3{background:var(--blue2);color:var(--blue);border:1px solid #cfe0ff;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
    .btn4{background:#10b981;color:#fff;border:0;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
    .danger{color:var(--danger);font-weight:900}
    .ok{color:var(--ok);font-weight:900}
    input,select{padding:10px;border-radius:12px;border:1px solid var(--border);width:100%;box-sizing:border-box}
    table{width:100%;border-collapse:collapse}
    td,th{padding:10px;border-bottom:1px solid #eef2f8;text-align:left;font-size:14px}
    a{color:var(--blue);font-weight:900;text-decoration:none}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 10px;border-radius:999px;background:#f3f4f6;font-weight:900;cursor:pointer}
    .tab.active{background:var(--blue);color:#fff}
    .hidden{display:none}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .kpi{border:1px solid var(--border);border-radius:14px;padding:14px;background:#fff}
    .kpi .label{color:var(--muted);font-size:12px;font-weight:800}
    .kpi .value{font-size:20px;font-weight:900;margin-top:6px}
    @media (max-width: 980px){ .kpis{grid-template-columns:repeat(2,1fr)} }
    @media (max-width: 520px){ .kpis{grid-template-columns:1fr} }

    .miniChart{margin-top:10px}
    .bars{display:flex;gap:6px;align-items:flex-end;height:54px}
    .bar{flex:1;background:#eef2ff;border-radius:8px;position:relative;overflow:hidden}
    .bar > i{position:absolute;left:0;bottom:0;width:100%;height:0;background:var(--blue)}
    .barLabel{display:flex;justify-content:space-between;margin-top:6px;color:var(--muted);font-size:12px}
    .box{border:1px solid var(--border);border-radius:14px;padding:12px;background:#fbfcff}

    /* Ultra lock */
    .lockBox{border:1px dashed #cfe0ff;background:#f6f9ff;border-radius:14px;padding:12px}
    .lockTitle{font-weight:900;color:var(--blue)}
    .lockSmall{font-size:12px;color:var(--muted);margin-top:6px}
    .hr{height:1px;background:#eef2f8;border:0;margin:12px 0}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="card">
      <div class="top">
        <div>
          <h1>Dashboard</h1>
          <div class="muted">Audit SEO ‚Ä¢ Monitoring ‚Ä¢ PDF ‚Ä¢ Historique ‚Ä¢ √âquipe (Ultra)</div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <span class="badge" id="planBadge">PLAN</span>
            <span class="pill" id="orgPill">Org: ‚Äî</span>
            <span class="pill" id="rolePill">R√¥le: ‚Äî</span>
            <span class="pill" id="trialPill">Trial: ‚Äî</span>
            <span class="pill" id="payPill">Paiement: ‚Äî</span>
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn3" id="btnPricing">Offres</button>
          <button class="btn" id="btnPortal">G√©rer / Upgrade</button>
          <button class="btn2" id="btnLogout">D√©connexion</button>
        </div>
      </div>

      <div id="msg" class="muted" style="margin-top:10px"></div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <button class="btn4" id="btnExportAudits">Exporter Audits CSV</button>
        <button class="btn4" id="btnExportMonitors">Exporter Monitors CSV</button>
        <button class="btn3" id="btnRefresh">Rafra√Æchir</button>
      </div>
      <div class="muted" style="margin-top:6px">Exports = 1 quota ‚Äúexports‚Äù. Stats = 7 derniers jours.</div>
    </div>

    <div class="card">
      <div class="kpis">
        <div class="kpi">
          <div class="label">Score SEO moyen (7j)</div>
          <div class="value" id="kpiScore">‚Äî</div>
        </div>
        <div class="kpi">
          <div class="label">Uptime estim√© (7j)</div>
          <div class="value" id="kpiUptime">‚Äî</div>
        </div>
        <div class="kpi">
          <div class="label">Temps moyen (7j)</div>
          <div class="value" id="kpiMs">‚Äî</div>
        </div>
        <div class="kpi">
          <div class="label">Audits (7j)</div>
          <div class="value" id="kpiAudits">‚Äî</div>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <div class="col box">
          <div style="font-weight:900">Audits / jour</div>
          <div class="miniChart">
            <div class="bars" id="chartAudits"></div>
            <div class="barLabel"><span>J-6</span><span>Aujourd‚Äôhui</span></div>
          </div>
        </div>
        <div class="col box">
          <div style="font-weight:900">Erreurs DOWN / jour</div>
          <div class="miniChart">
            <div class="bars" id="chartDowns"></div>
            <div class="barLabel"><span>J-6</span><span>Aujourd‚Äôhui</span></div>
          </div>
        </div>
      </div>

      <!-- NEW: Uptime chart (30j) -->
      <div class="row" style="margin-top:14px">
        <div class="col box">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900">Uptime / jour (30j)</div>
              <div class="muted" style="font-size:12px;margin-top:4px">Estimation bas√©e sur les logs du cron (UP / total checks).</div>
            </div>
            <div class="pill" id="uptime30Badge">30j: ‚Äî</div>
          </div>
          <div class="miniChart">
            <div class="bars" id="chartUptime30"></div>
            <div class="barLabel"><span>J-29</span><span>Aujourd‚Äôhui</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div class="col box">
          <div class="muted">Email</div>
          <div style="font-weight:900" id="email">‚Äî</div>
          <div class="muted" style="margin-top:8px">Entreprise</div>
          <div style="font-weight:900" id="company">‚Äî</div>
        </div>

        <div class="col box">
          <div style="font-weight:900">Quotas (mensuel)</div>

          <div style="margin-top:10px" class="muted">Audits: <b id="qa">0/0</b></div>
          <div style="margin-top:6px" class="muted">Monitors (cr√©ations): <b id="qm">0/0</b></div>
          <div style="margin-top:6px" class="muted">PDF: <b id="qp">0/0</b></div>
          <div style="margin-top:6px" class="muted">Exports: <b id="qe">0/0</b></div>

          <div class="muted" style="margin-top:10px">Reset: 1er jour du mois (UTC)</div>
        </div>

        <div class="col box">
          <div style="font-weight:900">Navigation</div>
          <div class="tabs" style="margin-top:10px">
            <div class="tab active" data-tab="audit">Audit</div>
            <div class="tab" data-tab="audits">Historique</div>
            <div class="tab" data-tab="monitor">Monitoring</div>
            <div class="tab" data-tab="settings">R√©glages</div>
            <div class="tab" data-tab="team" id="teamTab" style="display:none;">√âquipe</div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: Audit -->
    <div class="card" id="tab-audit">
      <div style="font-weight:900;font-size:18px">Audit SEO</div>
      <div class="muted">URL http/https ‚Üí score + recommandations + historique. Cache automatique si audit r√©cent.</div>

      <div class="row" style="margin-top:12px">
        <div class="col"><input id="auditUrl" placeholder="https://exemple.com" /></div>
        <div style="width:220px"><button class="btn" id="btnRunAudit" style="width:100%">Lancer audit</button></div>
      </div>

      <div id="auditResult" class="box hidden" style="margin-top:12px"></div>
    </div>

    <!-- TAB: Audits history -->
    <div class="card hidden" id="tab-audits">
      <div style="font-weight:900;font-size:18px">Historique des audits</div>
      <div class="muted">PDF disponible pour chaque audit.</div>

      <div class="box" style="margin-top:12px;overflow:auto">
        <table>
          <thead>
            <tr>
              <th>Date</th><th>URL</th><th>Score</th><th>PDF</th><th>D√©tails</th>
            </tr>
          </thead>
          <tbody id="auditsTbody"></tbody>
        </table>
      </div>
    </div>

    <!-- TAB: Monitoring -->
    <div class="card hidden" id="tab-monitor">
      <div style="font-weight:900;font-size:18px">Monitoring</div>
      <div class="muted">Les checks automatiques sont faits par le cron. Tu peux aussi ‚ÄúRun‚Äù manuellement.</div>

      <div class="row" style="margin-top:12px">
        <div class="col"><input id="monUrl" placeholder="https://exemple.com" /></div>
        <div style="width:220px">
          <input id="monInterval" type="number" min="5" value="60" />
          <div class="muted" style="font-size:12px;margin-top:6px">Interval minutes (min 5)</div>
        </div>
        <div style="width:220px"><button class="btn" id="btnCreateMon" style="width:100%">Cr√©er monitor</button></div>
      </div>

      <div class="box" style="margin-top:12px;overflow:auto">
        <table>
          <thead>
            <tr>
              <th>URL</th><th>Actif</th><th>Status</th><th>Dernier check</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="monTbody"></tbody>
        </table>
      </div>

      <div id="monLogsBox" class="box hidden" style="margin-top:12px;overflow:auto"></div>

      <hr class="hr"/>

      <!-- NEW: Monthly report (Ultra only) -->
      <div id="monthlyReportWrap">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
          <div>
            <div style="font-weight:900;font-size:18px">Rapport monitoring mensuel</div>
            <div class="muted">Score de fiabilit√© + incidents + uptime + latence (30 derniers jours).</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn3" id="btnBuildMonthly">G√©n√©rer le rapport</button>
            <button class="btn" id="btnPrintMonthly">Imprimer / PDF</button>
          </div>
        </div>

        <div id="monthlyLock" class="lockBox hidden" style="margin-top:12px">
          <div class="lockTitle">üîí Ultra uniquement</div>
          <div class="lockSmall">Upgrade vers Ultra pour acc√©der au rapport mensuel + score de fiabilit√©.</div>
        </div>

        <div id="monthlyReport" class="box hidden" style="margin-top:12px"></div>
      </div>
    </div>

    <!-- TAB: Settings -->
    <div class="card hidden" id="tab-settings">
      <div style="font-weight:900;font-size:18px">R√©glages alertes monitoring</div>
      <div class="muted">Owner : choisir qui re√ßoit les alertes + ajouter emails suppl√©mentaires.</div>

      <div class="row" style="margin-top:12px">
        <div class="col">
          <label class="muted" style="font-size:12px;font-weight:900">Destinataires</label>
          <select id="alertRecipients">
            <option value="all">Toute l‚Äô√©quipe (owner + members)</option>
            <option value="owner">Owner uniquement</option>
          </select>
        </div>
        <div class="col">
          <label class="muted" style="font-size:12px;font-weight:900">Emails suppl√©mentaires (s√©par√©s par virgule)</label>
          <input id="alertExtraEmails" placeholder="ops@entreprise.com, tech@entreprise.com" />
        </div>
        <div style="width:220px">
          <button class="btn" id="btnSaveSettings" style="width:100%;margin-top:20px">Enregistrer</button>
        </div>
      </div>

      <div class="muted" style="margin-top:10px">Les emails suppl√©mentaires re√ßoivent aussi les alertes.</div>
    </div>

    <!-- TAB: Team (Ultra) -->
    <div class="card hidden" id="tab-team">
      <div style="font-weight:900;font-size:18px">√âquipe (Ultra)</div>
      <div class="muted">Invite des membres (owner seulement). Donn√©es partag√©es au niveau org.</div>

      <div class="row" style="margin-top:12px">
        <div class="col">
          <input id="inviteEmail" placeholder="membre@entreprise.com" />
          <div class="muted" style="font-size:12px;margin-top:6px">Email du membre</div>
        </div>
        <div style="width:240px">
          <button class="btn" id="btnInvite" style="width:100%">Envoyer invitation</button>
          <div class="muted" style="font-size:12px;margin-top:6px">Requiert Ultra + r√¥le owner</div>
        </div>
      </div>

      <div class="box" style="margin-top:12px;overflow:auto">
        <table>
          <thead><tr><th>Email</th><th>Nom</th><th>R√¥le</th><th>Cr√©√©</th></tr></thead>
          <tbody id="teamTbody"></tbody>
        </table>
      </div>
    </div>

  </div>

  <script src="/dashboard.js"></script>
</body>
</html>
